########################################
# Actors: Farmer, Processor, Distributor, Retailer, Customer, Regulator
# Main State Transitions: Farmer -> Processor -> Distributor - > Retailer -> Customer -> Regulator
# Two parallel states: ProductFlow, RegulatorControl
# State Conditions: 
#  - Farmer: seedsPlanted, cropIsReady, cropHarvested, cropSent
#  - Processor: receivedCrop, cropProcessed, processedCropSent
#  - Distributor: stockReceived, stockEvaluated, deliverStocks, stockAvailable
#  - Retailer: 
#  - Customer: productFound, orderCreated, orderReceived, paymentComplete
#  - Regulator: qualityCriteriaMet, safetyCriteriaMet
########################################

statechart:
  # Initial Information about the Statechart
  name: Product Lifecycle in Blockchain
  description: Sismic Statechart representing the course of a product from farmer to customer using Ethereum Blockchain.
  # Initial conditions for the flow of product
  preamble: |
    seedsPlanted = False
    cropIsReady = False
    cropHarvested = False
    cropSent = False
    receivedCrop = False
    cropProcessed = False
    processedCropSent = False
    stockReceived = False
    stockEvaluated = False
    deliverStocks = Fasle
    stockAvailable = False
    stockReady = False
    productFound = False
    qualityCriteriaMet = False
    safetyCriteriaMet = False
  root state: 
    name: agricultureSystem
    parallel states:
      # Product Flow from Farmer to Customer
      - name: ProductFlow
        initial: Farmer
        states:
          # Farmer's Process
          ####################
          # States: Plant Seeds -> Crop Ready -> Harvest Crop -> Check Quality
          ####################
          - name: Farmer
            initial: plantSeeds
            states:
              - name: plantSeeds
                transitions:
                  - target: cropReady
                    action: seedsPlanted = True
              - name: cropReady
                transitions:
                  - target: cropHarvest
                    guard: seedsPlanted == True
                    action: cropIsReady = True
              - name: cropHarvest
                transitions:
                  - target: cropQuality
                    guard:  cropIsReady == True
                    action: cropHarvested = True
              - name: cropQuality
                transitions:
                  - target: Processor
                    guard: qualityCriteriaMet == True and safetyCriteriaMet == True and cropHarvested == True
                    action: |
                      cropSent = True
                      qualityCriteriaMet = False
                      safetyCriteriaMet = False
          # Processor's Process
          ####################
          # States: Receive Crop -> Process Crop -> Check Quality
          ####################
          - name: Processor
            initial: receiveCrop
            states:
              - name: receivedCrop
                transitions:
                  - target: cropProcess
                    guard: cropSent == True
                    action: receivedCrop = True
              - name: cropProcess
                transitions:
                  - target: processedCropQuality
                    guard:  receivedCrop == True
                    action: cropProcessed = True
              - name: processedCropQuality
                transitions:
                  - target: Distributor
                    guard: qualityCriteriaMet == True and safetyCriteriaMet == True and cropProcessed == True
                    action: |
                      processedCropSent = True
                      qualityCriteriaMet = False
                      safetyCriteriaMet = False
          # Distributor's Process
          ####################
          # States: Receive Stock -> Evaluate Stock -> Check Stock Quality
          ####################
          - name: Distributor
            initial: receiveStock
            states:
              - name: receiveStock
                transitions:
                  - target: evaluateStocks
                    guard: processedCropSent == True
                    action: stockReceived = True
              - name: evaluateStocks
                transitions:
                  - target: stockQuality
                    guard:  stockReceived == True
                    action: |
                      stockAvailable = True
                      stockEvaluated = True
              - name: stockQuality
                transitions:
                  - target: Retailer
                    guard: qualityCriteriaMet == True and safetyCriteriaMet == True and stockEvaluated == True
                    action: |
                      deliverStocks = True
                      stockAvailable = False
                      qualityCriteriaMet = False
                      safetyCriteriaMet = False
                  - target: Retailer
                    guard: qualityCriteriaMet == True and safetyCriteriaMet == True and stockAvailable == True
                    action: |
                      deliverStocks = True
                      qualityCriteriaMet = False
                      safetyCriteriaMet = False
          # Retailer's Process
          ####################
          # States: Receive Stocks -> Process Crop -> Check Quality
          ####################
          - name: Retailer
          # Customer's Process
          - name: Customer
            type: final
      # Regulation of the Product from Regulator on each Stakeholder
      - name: RegulatorControl
          ####################
          # States: Check Farmer, Check Processor, Check Distributor, Check Retailer
          ####################
        initial: checkFarmer
          states:
            - name: checkFarmer
              transitions:
                - target: checkProcessor
                action:
            - name: checkProcessor
            - name: checkDistributor
            - name: checkRetailer

 